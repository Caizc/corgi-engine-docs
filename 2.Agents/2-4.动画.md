# 动画

> 这个页面讲解了在 Corgi Engine 中如何使用动画。

## 简介

Corgi Engine 包含了很多原型角色，它们都自带了大量的**动画（Animation）**。在各种 Demo 中，你会发现有些角色使用了**精灵图集（Sprite sheet）**，有的使用 **Mecanim 动画系统**，或者 **Spine 骨骼动画**，或者 **3D 的 FBX 格式的动画模型**。你可以随心所欲地选择适合你的技能和需求的动画方式，不过 Corgi Engine 应该已经覆盖了任何你想要采用的方式了。

这个页面不会讲解所有关于如何创建动画的知识，Unity 官网上已经有[大量的文档](https://unity3d.com/cn/learn/tutorials/topics/animation)可供查阅。这里会讲解的是动画在 Corgi Engine 中的具体实现，以及它如何帮助你创建优美的动画角色。

## 动画控制器

![Rectangle 角色的动画控制器（Animator）](media/15009134926090.jpg)

大部分情况下，都需要有一个 **Animation Controller** 来设置动画。Corgi Engine 资源中包含了大量的 Animation Controller，我建议使用 `RectangleAnimator` 作为起点来创建自定义的 Animation Controller，由于它包含了所有的动画参数，所以你不需要再自己手动输入它们了。你可以简单地复制一个，然后把动画剪辑拖拽进去，替换原来属于 Rectangle 角色的那些就可以了。

角色的 Animator Controller 由两大部分组成：一部分是动画的参数（Animation Parameters），`Character` 和 `Character Abilities` 组件每帧都会更新它们，以映射角色的当前状态；另一部分是一个状态机（State Machine），你可以用它来定义每个动画在什么条件下会被播放，以及动画之间如何转换。

![一个动画状态转换的示例](media/15010347513179.jpg)

你会发现它的工作流程**非常简单**，由于大部分转换（Transition）都直接基于角色的当前状态，所以最困难的检验各种可能条件的部分，已经由引擎解决了。当然你也可以修改它来创建更加复杂的状态转换，如果那样的效果更好的话。

## 动画与脚本

Corgi Engine 的角色系统已经内建了动画操作接口，所以你不需要再花时间处理这些。每一种能力都已经加载了相应的动画参数。你可以使用 [Unity 内建的方法](https://docs.unity3d.com/Manual/AnimationParameters.html)或者由 Corgi Engine 提供的方法来更新动画参数。做法确实很简单，从任何一个能力中你只需重载两个方法。以喷气背包（Jetpack）能力为例，我们来看一下它是如何使用的吧。

**InitializeAnimatorParameters**：这个方法中注册了后面会使用到的参数，实际上它只是在检查了参数在 Animator Controller 中确实存在之后，把它放到一个列表中，以避免潜在的运行时错误。如果参数不存在，更新请求（Update Request）则不做任何事情，而不是触发错误。这种机制允许你在多个角色之间共用单一的 Animator，而不用将所有参数拷贝到所有 Animator Contoller 中。这个方法只在 `Initialization` 方法中被调用。

```csharp
protected override void InitializeAnimatorParameters()
{
	RegisterAnimatorParameter ("Jetpacking", AnimatorControllerParameterType.Bool);
}
```

**UpdateAnimator**：这个方法在每一帧中都会被调用，它会根据动画参数的当前值来更新 Animator 的参数。这个方法应该只包含对 `MMAnimator.UpdateAnimatorBool/Int/Trigger` 方法的调用。

```csharp
public override void UpdateAnimator()
{
MMAnimator.UpdateAnimatorBool(_animator,"Jetpacking",(_movement.CurrentState == CharacterStates.MovementStates.Jetpacking),_character._animatorParameters);
}
```

## 添加新的动画

添加一个**新的动画**，你只需要创建它，然后拖拽它到角色的 Animator Controller 中，再创建连接到它的转换（Transition）。如果新动画需要新的参数，确保将它们添加到 Animator Controller 的参数列表中，以及在脚本中使用以上提到的两个方法来注册和更新它们。

## 动画参数

以下是引擎中已存在的所有动画参数的详细列表：

| 参数名（Parameter Name） | 能力（Ability） | 类型（Type） | 作用（Role） |
| --- | --- | --- | --- |
| Grounded | Character | Boolean | 当角色与地面接触时为 true |
| Alive | Character | Boolean | 当角色活着时为 true |
| CollidingAbove | Character | Boolean | 当角色碰撞到上方的墙壁时为 true |
| CollidingBelow | Character | Boolean | 当角色碰撞到下方的墙壁时为 true |
| CollidingLeft | Character | Boolean | 当角色碰撞到它左边的墙壁时为 true |
| CollidingRight | Character | Boolean | 当角色碰撞到它右边的墙壁时为 true |
| Idle | Character | Boolean | 当角色处于闲置状态时为 true |
| Activating | CharacterButtonActivation | Boolean | 当角色激活某些东西时为 true |
| Crouching | CharacterCrouch | Boolean | 当角色蹲伏时为 true |
| Crawling | CharacterCrouch | Boolean | 当角色爬行时为 true |
| Dangling | CharacterDangling | Boolean | 当角色犹豫不决时为 true |
| Dashing | CharacterDashing | Boolean | 当角色冲撞时为 true |
| Diving | CharacterDive | Boolean | 当角色俯冲时为 true |
| Gripping | CharacterGrip | Boolean | 当角色抓握某些东西时为 true |
| Speed | CharacterHorizontalMovement | Float | 角色当前的水平速度 |
| xSpeed | Character | Float | 角色当前的水平速度 |
| ySpeed | Character | Float | 角色当前的竖直速度 |
| Walking | CharacterHorizontalMovement | Boolean | 当角色走路时为 true |
| Jetpacking | CharacterJetpack | Boolean | 当角色使用喷气背包时为 true |
| Jumping | CharacterJump | Boolean | 当角色跳跃时为 true |
| DoubleJumping | CharacterJump | Boolean | 当角色进行双段跳跃时为 true |
| HitTheGround | CharacterJump | Boolean | 如果这一帧角色刚好碰到地面则为 true |
| LadderClimbing | CharacterLadder | Boolean | 当角色爬梯子时为 true |
| LadderClimbingSpeedX | CharacterLadder | Float | 当角色在梯子上时的水平速度 |
| LadderClimbingSpeedY | CharacterLadder | Float | 当角色在梯子上时的竖直速度 |
| LookingUp | Character | Boolean | 当角色向上看时为 true |
| Running | CharacterRun | Boolean | 当角色跑动时为 true |
| WallClinging | CharacterWallClinging | Boolean | 当角色附着在墙壁上时为 true |
| WallJumping | CharacterWallJump | Boolean | 当角色从墙壁上跳跃时为 true |

除此之外，在 `CharacterHandleWeapon` 组件中你也会发现许多动画参数，在每个武器的 Inspector 视窗中你可以直接设置它们的名称。

## Spine

如果你想要使用 Spine，可以尝试以下两种方法：

......

// TODO: 本小节内容暂未翻译

-------

[本页面的 Corgi Engine 官方英文原版链接](http://corgi-engine-docs.moremountains.com/animations.html)

-------

